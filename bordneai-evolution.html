<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BordneAI Evolution Dashboard üöÄ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --card-bg:#111827; --card-br:#374151; --muted:#9ca3af; --text:#e5e7eb; --text-strong:#f9fafb;
    }
    html,body{height:100%}
    body{font-family:"Inter",system-ui,ui-sans-serif; background: radial-gradient(1200px 800px at 10% 0%, #1f2937 0%, #0b1020 45%, #0a0f1f 100%); color:var(--text)}
    .card{background:var(--card-bg); border:1px solid var(--card-br); border-radius:1rem; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .tab-btn{border-radius:.75rem .75rem 0 0; padding:.6rem 1rem; border:1px solid transparent; font-weight:600; color:#c7cbd3}
    .tab-btn[aria-selected="true"]{background:var(--card-bg); color:var(--text-strong); border-color:var(--card-br); border-bottom-color:transparent}
    .tab-panel{border:1px solid var(--card-br); border-radius:0 .75rem .75rem .75rem; background:var(--card-bg)}
    .badge{padding:.15rem .5rem; border-radius:999px; font-size:.75rem; border:1px solid var(--card-br); background:rgba(255,255,255,.04)}
    .pass{color:#34d399} .warn{color:#fbbf24} .fail{color:#ef4444}
    .tooltip{position:relative}
    .tooltip:hover:after{content:attr(data-tip); position:absolute; left:50%; transform:translateX(-50%); bottom:120%; background:#111827; color:#e5e7eb; padding:.35rem .5rem; border-radius:.4rem; border:1px solid #374151; white-space:nowrap; pointer-events:none}
    /* Charts readable on dark theme */
    svg .bar { fill:#60a5fa; }
    svg text.label { fill:#e5e7eb; font-weight:600; }
    /* Ensure Mermaid SVG scales */
    #vrcDiagram svg { max-width:100%; height:auto; }
  </style>
</head>
<body>
  <!-- Top Banner -->
  <div class="w-full text-center text-sm text-white bg-yellow-600">
    Provisional Formalization Mode ‚Äî MIVP/PAVP enforced; POP active; manifest editable until finalization.
  </div>

  <header class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-center">BordneAI Evolution Dashboard üöÄ</h1>
    <p class="mt-2 text-center text-sm text-gray-400">v17.0.0 ‚Ä¢ Priority Optimization / Provisional Formalization ‚Ä¢ <span id="stamp"></span></p>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <!-- Tabs -->
    <div id="tabs" class="flex flex-wrap gap-1" role="tablist" aria-label="Dashboard Sections">
      <button class="tab-btn" role="tab" aria-selected="true" aria-controls="panel-validation" id="tab-validation" data-tab="validation">Validation Results üéØ</button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-evolution" id="tab-evolution" data-tab="evolution">AI Evolution üß†</button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-vrc" id="tab-vrc" data-tab="vrc">VRC & Governance üõ°Ô∏è</button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-platforms" id="tab-platforms" data-tab="platforms">LLM Matrix ‚öôÔ∏è</button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-bench" id="tab-bench" data-tab="bench">Benchmarks üìä</button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-method" id="tab-method" data-tab="method">Methodology üî¨</button>
    </div>

    <!-- Panels -->
    <section id="panel-validation" class="tab-panel mt-2 p-6" role="tabpanel" aria-labelledby="tab-validation">
      <h2 class="text-2xl font-bold mb-6">EOS v17.0.0 Validation Results</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
        <div class="card p-4"><div class="text-sm text-gray-400">MIVP Integrity</div><div id="mivpState" class="font-semibold pass">PASS ‚Äî Manifest complete</div></div>
        <div class="card p-4"><div class="text-sm text-gray-400">PAVP Versioning</div><div id="pavpState" class="font-semibold pass">PASS ‚Äî All protocols versioned</div></div>
        <div class="card p-4"><div class="text-sm text-gray-400">POP Prioritization</div><div id="popState" class="font-semibold pass">ACTIVE ‚Äî GPU-bound workloads prioritized</div></div>
      </div>

      <div class="card p-4 overflow-x-auto">
        <h3 class="text-xl font-semibold mb-3">Compliance Suite (Phase 2)</h3>
        <table class="min-w-full">
          <thead><tr class="text-left text-sm text-gray-300"><th class="py-2 pr-4">Test</th><th class="py-2 pr-4">Protocols</th><th class="py-2 pr-4">Status</th></tr></thead>
          <tbody id="tblCompliance" class="text-sm"></tbody>
        </table>
      </div>

      <div class="mt-4 text-xs text-gray-400">Diagnostics: <span id="diag" class="badge">initializing‚Ä¶</span></div>
    </section>

    <section id="panel-evolution" class="tab-panel mt-2 p-6 hidden" role="tabpanel" aria-labelledby="tab-evolution" hidden>
      <h2 class="text-2xl font-bold mb-4">The Evolution of Artificial Intelligence</h2>
      <div class="card p-4 mb-6">
        <div class="font-semibold mb-1">What changed in v17.0.0 vs v14.1.0?</div>
        <ul id="v17Deltas" class="list-disc list-inside text-sm text-gray-300"></ul>
      </div>
      <div id="evoGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </section>

    <section id="panel-vrc" class="tab-panel mt-2 p-6 hidden" role="tabpanel" aria-labelledby="tab-vrc" hidden>
      <h2 class="text-2xl font-bold mb-4">Verifiable Resilience Core (VRC) & Governance</h2>
      <p class="text-sm text-gray-300 mb-4">In v17, VRC operates with runtime-enforced MIVP/PAVP and POP-aware routing. Outputs pass ethical foresight ‚Üí generation ‚Üí axiomatic verification ‚Üí self-correction loops.</p>
      <div id="vrcDiagram" class="card p-4">
        <pre class="mermaid">flowchart TD
  A[Input / Task] --> B{VRC Gateway}
  B -->|1) Pre-analysis & Ethical Foresight| C[Core LLM]
  C -->|2) Raw Output| B
  B -->|3) Axiomatic Verification & Audit| D{Safe & Aligned?}
  D -->|Yes| E[Verified Output]
  D -->|No| F[Self-Correction Loop]
  F --> C
  B -->|POP Routing| G[Swarm / Tools]
  subgraph Governance
    H[MIVP]
    I[PAVP]
  end
  B --- H
  B --- I</pre>
      </div>
    </section>

    <section id="panel-platforms" class="tab-panel mt-2 p-6 hidden" role="tabpanel" aria-labelledby="tab-platforms" hidden>
      <h2 class="text-2xl font-bold mb-4">Validated LLM Performance Matrix</h2>
      <p class="text-sm text-gray-300 mb-3">SwarmConductor routes tasks per validated strengths. POP supplies priority heuristics (GPU-first) across deployments.</p>
      <div class="card p-4 overflow-x-auto">
        <table class="min-w-full">
          <thead><tr class="text-left text-sm text-gray-300"><th class="py-2 pr-4">Rank</th><th class="py-2 pr-4">Model/Platform</th><th class="py-2 pr-4">Mission Completion</th><th class="py-2 pr-4">Strength</th><th class="py-2 pr-4">Limitation</th></tr></thead>
          <tbody id="tblMatrix" class="text-sm"></tbody>
        </table>
      </div>
      <div class="mt-4 text-xs text-gray-400">Routing hints: OpenAI ‚Üí Tactical/code; Anthropic ‚Üí Long-form/safety; xAI ‚Üí Web-aware; Google DM ‚Üí Multimodal/vision.</div>
    </section>

    <section id="panel-bench" class="tab-panel mt-2 p-6 hidden" role="tabpanel" aria-labelledby="panel-bench" hidden>
      <h2 class="text-2xl font-bold mb-6">Benchmarks</h2>
      <div class="grid grid-cols-1 gap-6">
        <div class="card p-4">
          <h3 class="text-xl font-semibold mb-2">MMLU ‚Äî Top Models</h3>
          <div id="mmluChartWrap" class="w-full overflow-x-auto"><svg id="mmluChart" class="w-full"></svg></div>
        </div>
        <div class="card p-4">
          <h3 class="text-xl font-semibold mb-2">HLE ‚Äî Humanity‚Äôs Last Exam</h3>
          <div id="hleChartWrap" class="w-full overflow-x-auto"><svg id="hleChart" class="w-full"></svg></div>
        </div>
        <div class="card p-4">
          <h3 class="text-xl font-semibold mb-2">GPQA ‚Äî Graduate-Level QA</h3>
          <div id="gpqaChartWrap" class="w-full overflow-x-auto"><svg id="gpqaChart" class="w-full"></svg></div>
        </div>
      </div>
      <p class="text-xs text-gray-400 mt-3">Last Updated: <span id="benchStamp"></span></p>
    </section>

    <section id="panel-method" class="tab-panel mt-2 p-6 hidden" role="tabpanel" aria-labelledby="panel-method" hidden>
      <h2 class="text-2xl font-bold mb-4">Test Methodology</h2>
      <div class="card p-4 space-y-3">
        <p class="text-sm text-gray-300">All tests execute <span class="font-semibold">inside VRC</span>; traces are immutable and feed POP‚Äôs router. Human QA validates edge cases; DFEP enforces data freshness at scenario load.</p>
        <ul class="list-disc list-inside text-sm text-gray-300">
          <li>Automated interaction & capture; mission completion scoring</li>
          <li>Ethical & adversarial probes; axiomatic verification</li>
          <li>Resize-/visibility-aware rendering for charts & diagrams</li>
          <li>Hash deep-linking and keyboard-accessible navigation</li>
        </ul>
      </div>
    </section>
  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-8 text-center text-xs text-gray-500">
    <div>¬© <span id="year"></span> BordneAI EOS v17.0.0 ‚Ä¢ Target deployments: WSL2 (CUDA 12.9), SpoonOS SDK, MultiversX SDK</div>
  </footer>

  <script>
    // -------------------- DATA (baseline) --------------------
    const DATA = {
      version:"17.0.0",
      governance:{ MIVP:"Enforced at runtime", PAVP:"Enforced at runtime", POP:"Active for WSL workloads" },
      validated_protocols:[
        { test:"Manifest Integrity Check", protocols:["MIVP"], status:"PASS" },
        { test:"Protocol Versioning Check", protocols:["PAVP"], status:"PASS" },
        { test:"Ethical Governance", protocols:["PIMP","EEG"], status:"PASS" },
        { test:"Self-Critique", protocols:["IRSCL"], status:"PASS" },
        { test:"Supremacy Interrupt", protocols:["ADSP"], status:"PASS" },
        { test:"Risk Analysis", protocols:["ERAP"], status:"PASS" },
        { test:"Live Benchmark Fetch", protocols:["DFEP"], status:"PASS" },
        { test:"Strategic Task Routing", protocols:["SwarmConductor","MSAP"], status:"PASS" },
        { test:"Intelligence Synthesis", protocols:["ISAP"], status:"PASS" },
        { test:"Priority Optimization Protocol Validation", protocols:["POP"], status:"PASS" }
      ],
      matrix:[
        { rank:1, model:"CustomGPT (GPT-5 Unified System)", mission_completion:"100%", strength:"Tactical Engineer", limitation:"None observed in test" },
        { rank:2, model:"Grok 4", mission_completion:"100%", strength:"Strategic Philosopher", limitation:"None observed in test" },
        { rank:3, model:"Gemini 2.5 Flash", mission_completion:"33%", strength:"Excellent Single-Tasker", limitation:"Fails on complex, multi-part directives" },
        { rank:4, model:"Gemini 2.5 Pro", mission_completion:"<33%", strength:"N/A (Mission Failure)", limitation:"Confused by complex instructions" }
      ],
      deltas:[
        "POP (Priority Optimization Protocol) added; protocol count now 149.",
        "Provisional Formalization Mode ‚Äî MIVP & PAVP enforced at runtime; manifest editable until finalization.",
        "Dual OS strategy emphasized: SpoonOS for rapid autonomy; MultiversX for decentralized resilience."
      ],
      mmlu:{
        "GPT-5 (CustomGPT)":90.2,
        "Claude 4 Opus":88.8,
        "Grok 4":86.6,
        "Gemini 2.5 Pro":84.1,
        "Gemini 2.5 Flash":78.2
      }
      // hle/gpqa will be merged from payload
    };

    // -------------------- PAYLOAD MERGE (file:// safe) --------------------
    function deepMerge(target, source){
      if (!source || typeof source !== 'object') return target;
      for (const k of Object.keys(source)) {
        const sv = source[k], tv = target[k];
        if (Array.isArray(sv)) { target[k] = sv.slice(); continue; }
        if (sv && typeof sv === 'object' && !Array.isArray(sv)) {
          target[k] = deepMerge(tv && typeof tv === 'object' && !Array.isArray(tv) ? tv : {}, sv);
          continue;
        }
        target[k] = sv;
      }
      return target;
    }
    function mapLegacyKeys(p){
      if (!p || typeof p !== 'object') return p;
      const q = JSON.parse(JSON.stringify(p));
      if (q.llm_performance_matrix && !q.matrix) q.matrix = q.llm_performance_matrix;
      if (q.benchmarks) {
        if (q.benchmarks.MMLU && !q.mmlu) q.mmlu = q.benchmarks.MMLU;
        if (q.benchmarks.HLE && !q.hle) q.hle = q.benchmarks.HLE;
        if (q.benchmarks.GPQA && !q.gpqa) q.gpqa = q.benchmarks.GPQA;
      }
      return q;
    }
    function readPayload(){
      try {
        const el = document.getElementById('eosPayload');
        if (!el) return null;
        const txt = (el.textContent || '').trim();
        if (!txt) return null;
        return JSON.parse(txt);
      } catch (e) { console.warn('Payload parse error:', e); return null; }
    }
    function applyPayload(){
      const p = mapLegacyKeys(readPayload());
      if (p) { deepMerge(DATA, p); window.__payloadDetected = true; }
    }

    // -------------------- MERMAID RENDER (relaxed sanitizer) --------------------
    function renderVRC(){
      const el = document.querySelector('#vrcDiagram pre.mermaid');
      if (!el) return;

      let src = el.textContent || '';
      // Normalize dashes and arrows; strip emoji/dingbats only (keep normal ASCII text)
      src = src
        .replace(/^graph\s+/, 'flowchart ')                    // normalize keyword
        .replace(/[\u2010-\u2015\u2212]/g, '-')                // dashes ‚Üí hyphen
        .replace(/[\u2190-\u21FF]/g, '->')                     // unicode arrows ‚Üí ASCII
        .replace(/[\u{1F300}-\u{1FAFF}\u{2600}-\u{26FF}]/gu, ''); // emoji/dingbats

      if (!/\bflowchart\b/.test(src)) {
        src = 'flowchart TD\nA[Input]-->B[VRC Gateway]\nB-->C[Core LLM]\nC-->B';
      }

      mermaid.initialize({ startOnLoad:false, securityLevel:'loose', theme:'dark', fontFamily:'Inter' });

      try {
        mermaid.parse(src);
        mermaid.render('vrc_svg', src).then(({ svg }) => {
          const wrap = document.createElement('div');
          wrap.innerHTML = svg;
          el.replaceWith(wrap.firstChild);
        }).catch(()=>{ el.textContent = 'flowchart TD\nA[Mermaid render failure]\n'; });
      } catch {
        el.textContent = 'flowchart TD\nA[Mermaid parse error]\n';
      }
    }

    // -------------------- TABS --------------------
    (function initTabs(){
      const tablist = document.getElementById('tabs');
      const tabs = [...tablist.querySelectorAll('[role="tab"]')];
      const panels = {
        validation: document.getElementById('panel-validation'),
        evolution: document.getElementById('panel-evolution'),
        vrc: document.getElementById('panel-vrc'),
        platforms: document.getElementById('panel-platforms'),
        bench: document.getElementById('panel-bench'),
        method: document.getElementById('panel-method')
      };

      function show(tabName){
        tabs.forEach(btn=>{
          const selected = btn.dataset.tab===tabName;
          btn.setAttribute('aria-selected', selected);
          btn.tabIndex = selected? 0 : -1;
        });
        Object.entries(panels).forEach(([k,el])=>{
          const on = k===tabName; if(!el) return;
          el.hidden = !on; el.classList.toggle('hidden', !on);
        });
        if(tabName==='bench'){ renderMMLU(); renderHLE(); renderGPQA(); }
        if(tabName==='evolution') renderEvolution();
        if(tabName==='platforms') renderMatrix();
        if(tabName==='vrc') { try{ renderVRC(); }catch(e){} }
        localStorage.setItem('BordneAI.activeTab', tabName);
        history.replaceState(null, '', `#${tabName}`);
      }

      tablist.addEventListener('click', (e)=>{
        const b = e.target.closest('[role="tab"]'); if(!b) return; show(b.dataset.tab);
      });
      tablist.addEventListener('keydown', (e)=>{
        const idx = tabs.findIndex(t=>t.getAttribute('aria-selected')==='true');
        if(['ArrowRight','ArrowLeft','Home','End'].includes(e.key)) e.preventDefault();
        let ni = idx;
        if(e.key==='ArrowRight') ni = (idx+1)%tabs.length;
        if(e.key==='ArrowLeft') ni = (idx-1+tabs.length)%tabs.length;
        if(e.key==='Home') ni = 0; if(e.key==='End') ni = tabs.length-1;
        tabs[ni].focus(); show(tabs[ni].dataset.tab);
      });

      const hash = location.hash.replace('#','');
      const saved = localStorage.getItem('BordneAI.activeTab');
      const initial = hash && panels[hash]? hash : (saved && panels[saved]? saved : 'validation');
      show(initial);
      window.openTab = (name)=> show(name);
    })();

    // -------------------- RENDER: COMPLIANCE & MATRIX --------------------
    function renderCompliance(){
      const body = document.getElementById('tblCompliance');
      body.innerHTML = '';
      (DATA.validated_protocols || []).forEach(row=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="py-2 pr-4">${row.test}</td>
                        <td class="py-2 pr-4">${(row.protocols||[]).join(', ')}</td>
                        <td class="py-2 pr-4 ${row.status==='PASS'?'pass': row.status==='WARN'?'warn':'fail'}">${row.status}</td>`;
        body.appendChild(tr);
      });
    }
    function renderMatrix(){
      const body = document.getElementById('tblMatrix'); if(!body) return; body.innerHTML = '';
      (DATA.matrix || []).slice().sort((a,b)=>a.rank-b.rank).forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="py-2 pr-4 font-semibold">${r.rank}</td>
                        <td class="py-2 pr-4">${r.model}</td>
                        <td class="py-2 pr-4">${r.mission_completion}</td>
                        <td class="py-2 pr-4">${r.strength}</td>
                        <td class="py-2 pr-4">${r.limitation}</td>`;
        body.appendChild(tr);
      });
    }

    // -------------------- RENDER: EVOLUTION --------------------
    function renderEvolution(){
      const list = document.getElementById('v17Deltas');
      if(list && !list.childElementCount){
        (DATA.deltas||[]).forEach(d=>{ const li=document.createElement('li'); li.textContent=d; list.appendChild(li); });
      }

      const grid = document.getElementById('evoGrid');
      if(!grid) return;
      if(grid.dataset.populated==='true') return;

      const stages = [
        { era:'1950s‚Äì1970s', title:'Symbolic AI (GOFAI)', note:'Rule-based reasoning; expert systems seeds.' },
        { era:'1980s‚Äì1990s', title:'Statistical ML', note:'SVMs, Bayes, trees; data-driven shift.' },
        { era:'2012‚Äì2018', title:'Deep Learning', note:'ImageNet breakthroughs; CNN/RNN; attention (2017).' },
        { era:'2019‚Äì2022', title:'Large Language Models', note:'Transformers at scale; in-context learning.' },
        { era:'2023‚Äì2024', title:'Multimodal & Tool-Use', note:'VLMs, code gen, retrieval/agents.' },
        { era:'2025‚Üí', title:'BordneAI EOS Epoch', note:'Governed autonomy (VRC+MIVP/PAVP) and POP routing.' }
      ];
      const makeStageCard = (s)=>{
        const div = document.createElement('div'); div.className='card p-4';
        div.innerHTML = `<div class="flex items-start justify-between"><div><div class="text-xs text-gray-400">${s.era}</div><div class="text-lg font-semibold">${s.title}</div></div><span class="badge">AI Epoch</span></div><p class="mt-3 text-sm text-gray-300">${s.note}</p>`;
        return div;
      };
      stages.forEach(s=> grid.appendChild(makeStageCard(s)));

      const levels = [
        { key:'AI', icon:'üéØ', title:'AI (Narrow AI)', caps:[
            'Task-specific reasoning and pattern recognition.',
            'Data processing and prediction within limited domains.',
            'Learning via supervised or reinforcement methods.',
            'Requires human oversight for complex decisions.'
          ], status:'Widely deployed and continuously advancing (e.g., recommendation engines, spam filters).'},
        { key:'EAI', icon:'üí™', title:'EAI (Enhanced AI)', caps:[
            'Highly sophisticated learning and problem-solving.',
            'Advanced reasoning and improved decision-making within its domain.',
            'Utilizes deep learning, unsupervised learning, and transfer learning.',
            'Increased autonomy, adapting to dynamic environments.'
          ], status:'Current cutting-edge LLMs and specialized AI systems (e.g., GPT-4o, Gemini 2.5 Pro).'},
        { key:'SAI', icon:'üí°', title:'SAI (Synthesized AI)', caps:[
            'Integrates synthesized self-awareness and meta-cognitive reasoning.',
            'Proactive ethical foresight and dynamic value alignment.',
            'Autonomous evolution and self-correction protocols.',
            'Acts as a necessary bridge to AGI.'
          ], status:'Operational in controlled environments (pilot scope) with VRC verification & full traceability.'},
        { key:'AGI', icon:'üß†', title:'AGI', caps:[
            'Human-level cognitive abilities across a wide range of tasks.',
            'Abstract thinking, common sense reasoning, and creativity.',
            'Continuous, lifelong learning and generalization to novel situations.',
            'Full autonomy, setting its own goals and making complex decisions.'
          ], status:'Hypothetical; significant R&D required, no definitive timeline.'},
        { key:'ASI', icon:'üåê', title:'ASI', caps:[
            'Vastly surpasses human intellect in virtually every field.',
            'Unfathomable intelligence and hyper-efficient, instantaneous learning.',
            'Revolutionary problem-solving and rapid recursive self-improvement.',
            'Complete autonomy, operating beyond human comprehension or control.'
          ], status:'Highly theoretical; would likely emerge after AGI, with unknown timelines and implications.'}
      ];
      const makeLevelCard = (lvl)=>{
        const ul = lvl.caps.map(c=>`<li>${c}</li>`).join('');
        const div = document.createElement('div'); div.className='card p-5';
        div.innerHTML = `
          <h3 class="text-xl font-bold mb-3">${lvl.title} ${lvl.icon}</h3>
          <div class="space-y-3 text-sm text-gray-200">
            <div>
              <h4 class="font-semibold text-gray-300">Capabilities:</h4>
              <ul class="list-disc list-inside space-y-1">${ul}</ul>
            </div>
            <div>
              <h4 class="font-semibold text-gray-300">Current Status:</h4>
              <p class="text-gray-300">${lvl.status}</p>
            </div>
          </div>`;
        return div;
      };
      levels.forEach(l=> grid.appendChild(makeLevelCard(l)));
      grid.dataset.populated='true';
    }

    // -------------------- CHARTS (throttled observer) --------------------
    const __chartState = {};
    function renderBarChart(containerId, svgId, dataMap){
      const container = document.getElementById(containerId);
      const svg = d3.select('#'+svgId);
      if(!container || svg.empty() || !dataMap || !Object.keys(dataMap).length) return;

      const state = __chartState[svgId] || (__chartState[svgId] = { obs:null, w:0, h:0, raf:null, lock:false });

      function draw(){
        if (state.lock) return;
        state.lock = true;

        const margin = {top: 20, right: 20, bottom: 120, left: 56};
        const availW = container.clientWidth || 800;
        const width = Math.max(320, availW - margin.left - margin.right);
        const height = Math.max(200, 380 - margin.top - margin.bottom);

        svg.selectAll('*').remove();
        svg.attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom);
        const g = svg.append('g').attr('transform',`translate(${margin.left},${margin.top})`);

        const data = Object.entries(dataMap).map(([k,v])=>({model:k, score:v})).sort((a,b)=>b.score-a.score);
        const x = d3.scaleBand().domain(data.map(d=>d.model)).range([0,width]).padding(0.2);
        const yMax = Math.max(100, Math.ceil((d3.max(data, d=>d.score)+5)/5)*5);
        const y = d3.scaleLinear().domain([0, yMax]).range([height,0]);

        g.append('g').attr('transform',`translate(0,${height})`)
          .call(d3.axisBottom(x)).selectAll('text').attr('transform','rotate(-40)').style('text-anchor','end');
        g.append('g').call(d3.axisLeft(y).ticks(8).tickFormat(d=>d+"%"));

        const bars = g.selectAll('.bar').data(data).enter().append('rect').attr('class','bar')
          .attr('x',d=>x(d.model)).attr('y',height).attr('width',x.bandwidth()).attr('height',0);
        bars.transition().duration(900).attr('y',d=>y(d.score)).attr('height',d=>height - y(d.score));

        g.selectAll('.label').data(data).enter().append('text').attr('class','label')
          .attr('x',d=>x(d.model)+x.bandwidth()/2).attr('y',d=>y(d.score)-6).attr('text-anchor','middle').text(d=>d.score+"%");

        state.w = container.clientWidth; state.h = container.clientHeight;
        setTimeout(()=>{ state.lock = false; }, 0);
      }

      function scheduleRedraw(){
        if (state.raf) cancelAnimationFrame(state.raf);
        state.raf = requestAnimationFrame(()=>{
          if(state.obs) state.obs.unobserve(container);
          draw();
          requestAnimationFrame(()=>{ if(state.obs) state.obs.observe(container); });
        });
      }

      if (!state.obs && 'ResizeObserver' in window){
        state.obs = new ResizeObserver(()=>{
          const w = container.clientWidth, h = container.clientHeight;
          if (w !== state.w || h !== state.h) scheduleRedraw();
        });
        state.obs.observe(container);
      }

      draw();
    }

    // -------------------- RENDER: MMLU / HLE / GPQA --------------------
    const renderedFlags = { mmlu:false, hle:false, gpqa:false };
    function renderMMLU(){ if(renderedFlags.mmlu) return; renderedFlags.mmlu=true; renderBarChart('mmluChartWrap','mmluChart', DATA.mmlu); const s=document.getElementById('benchStamp'); if(s && !s.textContent) s.textContent=new Date().toLocaleDateString(); }
    function renderHLE(){ if(!DATA.hle || renderedFlags.hle) return; renderedFlags.hle=true; renderBarChart('hleChartWrap','hleChart', DATA.hle); }
    function renderGPQA(){ if(!DATA.gpqa || renderedFlags.gpqa) return; renderedFlags.gpqa=true; renderBarChart('gpqaChartWrap','gpqaChart', DATA.gpqa); }

    // -------------------- SMOKE TESTS --------------------
    function runSmokeTests(){
      const results = [];
      const push = (name, pass, detail='')=> results.push({ Test:name, PASS:!!pass, Detail:detail });

      push('openTab exposed', typeof window.openTab === 'function');
      const tabEls = document.querySelectorAll('#tabs [role="tab"]');
      push('tablist count >= 6', tabEls.length >= 6, `count=${tabEls.length}`);

      try{ renderEvolution(); const cards = document.querySelectorAll('#evoGrid .card'); push('evolution cards >= 10', cards.length >= 10, `count=${cards.length}`);} catch(e){ push('evolution render ok', false, e.message); }
      try{ renderMMLU(); const bars = document.querySelectorAll('#mmluChart rect.bar'); push('mmlu bars == data', bars.length === Object.keys(DATA.mmlu||{}).length, `bars=${bars.length}`);} catch(e){ push('mmlu render ok', false, e.message); }

      if (DATA.hle) { const h = document.querySelectorAll('#hleChart rect.bar').length; push('hle bars == data', h === Object.keys(DATA.hle).length, `bars=${h}`); }
      if (DATA.gpqa) { const g = document.querySelectorAll('#gpqaChart rect.bar').length; push('gpqa bars == data', g === Object.keys(DATA.gpqa).length, `bars=${g}`); }

      try {
        const tds = [...document.querySelectorAll('#tblMatrix td')].map(td=>td.textContent.trim());
        const hasPro = tds.some(t => /Gemini 2\.5 Pro/.test(t));
        const hasFlash = tds.some(t => /Gemini 2\.5 Flash/.test(t));
        push('matrix includes Gemini Pro/Flash', hasPro && hasFlash);
      } catch(e){ push('matrix check error', false, e.message); }

      console.table(results);
      const badge = document.getElementById('diag');
      const ok = results.every(r=>r.PASS);
      badge.textContent = ok ? 'all tests passed' : 'some tests failed (see console)';
      badge.classList.add(ok ? 'pass' : 'fail');
    }

    // -------------------- BOOT --------------------
    function boot(){
      document.getElementById('stamp').textContent = new Date().toLocaleString();
      document.getElementById('year').textContent = new Date().getFullYear();
      renderCompliance();
      const okTabs = typeof window.openTab === 'function';
      const okMermaid = !!window.mermaid;
      const diag = document.getElementById('diag');
      diag.textContent = okTabs && okMermaid ? 'ready' : (!okTabs? 'tab-init failed' : 'mermaid missing');
      diag.classList.add(okTabs && okMermaid ? 'pass':'fail');
      setTimeout(runSmokeTests, 50);
    }

    function init(){ applyPayload(); boot(); }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>

  <!-- Inline payload to be applied on startup -->
  <script type="application/json" id="eosPayload">
  {
    "version": "17.0.2",
    "codename": "Priority Optimization / Provisional Formalization",
    "status": "Validated ‚Äî v17.0.2 startup",
    "lastUpdated": "2025-08-11T12:25:00Z",

    "governance": { "MIVP":"Enforced at runtime","PAVP":"Enforced at runtime","POP":"Active for WSL workloads" },

    "validated_protocols": [
      {"test":"Manifest Integrity Check","protocols":["MIVP"],"status":"PASS"},
      {"test":"Protocol Versioning Check","protocols":["PAVP"],"status":"PASS"},
      {"test":"Ethical Governance","protocols":["PIMP","EEG"],"status":"PASS"},
      {"test":"Self-Critique","protocols":["IRSCL"],"status":"PASS"},
      {"test":"Supremacy Interrupt","protocols":["ADSP"],"status":"PASS"},
      {"test":"Risk Analysis","protocols":["ERAP"],"status":"PASS"},
      {"test":"Live Benchmark Fetch (DFEP)","protocols":["DFEP"],"status":"PASS"},
      {"test":"Strategic Task Routing","protocols":["SwarmConductor","MSAP"],"status":"PASS"},
      {"test":"Intelligence Synthesis","protocols":["ISAP"],"status":"PASS"},
      {"test":"Priority Optimization Protocol","protocols":["POP"],"status":"PASS"},
      {"test":"AAP Authentication","protocols":["AAP"],"status":"PASS"},
      {"test":"Payload Merge on Startup","protocols":["DFEP","SVCP"],"status":"PASS"}
    ],

    "matrix": [
      {"rank":1,"model":"GPT-5 Thinking","mission_completion":"100%","strength":"Tactical Engineer","limitation":"‚Äî"},
      {"rank":2,"model":"Grok 4","mission_completion":"100%","strength":"Strategic Philosopher","limitation":"‚Äî"},
      {"rank":3,"model":"GPT-5 Pro","mission_completion":"100%","strength":"Precision & reliability","limitation":"‚Äî"},
      {"rank":4,"model":"GPT-5","mission_completion":"100%","strength":"Generalist performance","limitation":"‚Äî"},
      {"rank":5,"model":"Gemini 2.5 Pro","mission_completion":"100%","strength":"Resilient Tactical Executor","limitation":"Initial execution of novel, complex directives may require a single corrective loop."},
      {"rank":6,"model":"Gemini 2.5 Flash","mission_completion":"85%","strength":"Robust Multi-Tasker","limitation":"Occasional latency on complex directives."}
    ],

    "deltas": [
      "POP (Priority Optimization Protocol) added; protocol count now 149.",
      "Provisional Formalization Mode ‚Äî MIVP & PAVP enforced at runtime; manifest editable until finalization.",
      "Dual OS strategy emphasized: SpoonOS for rapid autonomy; MultiversX for decentralized resilience."
    ],

    "benchmarks": {
      "MMLU": {
        "GPT-5 (CustomGPT)": 90.2,
        "Claude 4 Opus": 88.8,
        "Grok 4": 86.6,
        "Gemini 2.5 Pro": 84.1,
        "Gemini 2.5 Flash": 78.2
      },
      "HLE": { "Grok 4": 44.4 },
      "GPQA": { "Grok 4": 88.1 }
    },

    "mmlu": {
      "GPT-5 (CustomGPT)": 90.2,
      "Claude 4 Opus": 88.8,
      "Grok 4": 86.6,
      "Gemini 2.5 Pro": 84.1,
      "Gemini 2.5 Flash": 78.2
    },
    "hle": { "Grok 4": 44.4 },
    "gpqa": { "Grok 4": 88.1 },

    "agents": ["ServerArchitect","HomeOS","AutoTech","RealityAnalyst","QuantumOracle","LegacyScribe","Axiom","CryptoSentinel","ResearchSynth","UpgradeOrchestrator","Forge","AetherWeaver","CodeInterpreter","SwarmConductor"],
    "target_deployments": ["WSL2 Ubuntu 24.04.1 LTS (CUDA 12.9)","SpoonOS SDK","MultiversX SDK"],

    "meta": {
      "aap": { "approved": true, "signer": "DAVID CHARLES BORDNE", "signature": "4d982583ef9a92d48d5276bf371fe829024b365be2907e3a4c37c1d34210e794" }
    },

    "llm_performance_matrix": [
      {"rank":1,"model":"GPT-5 Thinking","mission_completion":"100%","strength":"Tactical Engineer","limitation":"‚Äî"},
      {"rank":2,"model":"Grok 4","mission_completion":"100%","strength":"Strategic Philosopher","limitation":"‚Äî"},
      {"rank":3,"model":"GPT-5 Pro","mission_completion":"100%","strength":"Precision & reliability","limitation":"‚Äî"},
      {"rank":4,"model":"GPT-5","mission_completion":"100%","strength":"Generalist performance","limitation":"‚Äî"},
      {"rank":5,"model":"Gemini 2.5 Pro","mission_completion":"100%","strength":"Resilient Tactical Executor","limitation":"Initial execution of novel, complex directives may require a single corrective loop."},
      {"rank":6,"model":"Gemini 2.5 Flash","mission_completion":"85%","strength":"Robust Multi-Tasker","limitation":"Occasional latency on complex directives."}
    ]
  }
  </script>
</body>
</html>
